{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState } from 'react';\nimport Head from 'next/head';\nimport { SiteContext, ContextProviderComponent } from \"../context/mainContext\";\nimport DENOMINATION from \"../utils/currencyProvider\";\nimport { FaLongArrowAltLeft } from \"react-icons/fa\";\nimport Link from \"next/link\";\nimport Image from \"../components/Image\";\nimport { v4 as uuid } from \"uuid\";\nimport { CardElement, Elements, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\"; // Make sure to call `loadStripe` outside of a componentâ€™s render to avoid\n// recreating the `Stripe` object on every render.\n\nvar stripePromise = loadStripe(\"xxx-xxx-xxx\");\n\nfunction CheckoutWithContext(props) {\n  return /*#__PURE__*/_jsx(ContextProviderComponent, {\n    children: /*#__PURE__*/_jsx(SiteContext.Consumer, {\n      children: function children(context) {\n        return /*#__PURE__*/_jsx(Elements, {\n          stripe: stripePromise,\n          children: /*#__PURE__*/_jsx(Checkout, _objectSpread(_objectSpread({}, props), {}, {\n            context: context\n          }))\n        });\n      }\n    })\n  });\n}\n\nvar calculateShipping = function calculateShipping() {\n  return 0;\n};\n\nvar Input = function Input(_ref) {\n  var onChange = _ref.onChange,\n      value = _ref.value,\n      name = _ref.name,\n      placeholder = _ref.placeholder;\n  return /*#__PURE__*/_jsx(\"input\", {\n    onChange: onChange,\n    value: value,\n    className: \"mt-2 text-sm shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",\n    type: \"text\",\n    placeholder: placeholder,\n    name: name\n  });\n};\n\nvar Checkout = function Checkout(_ref2) {\n  var _jsx2, _jsx3;\n\n  var context = _ref2.context;\n\n  var _useState = useState(null),\n      errorMessage = _useState[0],\n      setErrorMessage = _useState[1];\n\n  var _useState2 = useState(false),\n      orderCompleted = _useState2[0],\n      setOrderCompleted = _useState2[1];\n\n  var _useState3 = useState({\n    name: \"\",\n    email: \"\",\n    street: \"\",\n    city: \"\",\n    postal_code: \"\",\n    state: \"\"\n  }),\n      input = _useState3[0],\n      setInput = _useState3[1];\n\n  var stripe = useStripe();\n  var elements = useElements();\n\n  var onChange = function onChange(e) {\n    setErrorMessage(null);\n    setInput(_objectSpread(_objectSpread({}, input), {}, _defineProperty({}, e.target.name, e.target.value)));\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var name, email, street, city, postal_code, state, total, clearCart, cardElement, _yield$stripe$createP, error, paymentMethod, order;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              name = input.name, email = input.email, street = input.street, city = input.city, postal_code = input.postal_code, state = input.state;\n              total = context.total, clearCart = context.clearCart;\n\n              if (!(!stripe || !elements)) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 5:\n              if (!(!street || !city || !postal_code || !state)) {\n                _context.next = 8;\n                break;\n              }\n\n              setErrorMessage(\"Please fill in the form!\");\n              return _context.abrupt(\"return\");\n\n            case 8:\n              // Get a reference to a mounted CardElement. Elements knows how\n              // to find your CardElement because there can only ever be one of\n              // each type of element.\n              cardElement = elements.getElement(CardElement); // Use your card Element with other Stripe.js APIs\n\n              _context.next = 11;\n              return stripe.createPaymentMethod({\n                type: \"card\",\n                card: cardElement,\n                billing_details: {\n                  name: name\n                }\n              });\n\n            case 11:\n              _yield$stripe$createP = _context.sent;\n              error = _yield$stripe$createP.error;\n              paymentMethod = _yield$stripe$createP.paymentMethod;\n\n              if (!error) {\n                _context.next = 17;\n                break;\n              }\n\n              setErrorMessage(error.message);\n              return _context.abrupt(\"return\");\n\n            case 17:\n              order = {\n                email: email,\n                amount: total,\n                address: state,\n                // should this be {street, city, postal_code, state} ?\n                payment_method_id: paymentMethod.id,\n                receipt_email: \"customer@example.com\",\n                id: uuid()\n              }; // TODO call API\n\n              setOrderCompleted(true);\n              clearCart();\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var numberOfItemsInCart = context.numberOfItemsInCart,\n      cart = context.cart,\n      total = context.total;\n  var cartEmpty = numberOfItemsInCart === Number(0);\n\n  if (orderCompleted) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      children: /*#__PURE__*/_jsx(\"h3\", {\n        children: \"Thanks! Your order has been successfully processed.\"\n      })\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"flex flex-col items-center pb-10\",\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"title\", {\n        children: \"Jamstack ECommerce - Checkout\"\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        name: \"description\",\n        content: \"Check out\"\n      }), /*#__PURE__*/_jsx(\"meta\", {\n        property: \"og:title\",\n        content: \"Jamstack ECommerce - Checkpit\"\n      }, \"title\")]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \" flex flex-col w-full c_large:w-c_large \",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"pt-10 pb-8\",\n        children: [/*#__PURE__*/_jsx(\"h1\", {\n          className: \"text-5xl font-light mb-6\",\n          children: \"Checkout\"\n        }), /*#__PURE__*/_jsx(Link, {\n          href: \"/cart\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            \"aria-label\": \"Cart\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"cursor-pointer flex  items-center\",\n              children: [/*#__PURE__*/_jsx(FaLongArrowAltLeft, {\n                className: \"mr-2 text-gray-600\"\n              }), /*#__PURE__*/_jsx(\"p\", {\n                className: \"text-gray-600 text-sm\",\n                children: \"Edit Cart\"\n              })]\n            })\n          })\n        })]\n      }), cartEmpty ? /*#__PURE__*/_jsx(\"h3\", {\n        children: \"No items in cart.\"\n      }) : /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"\",\n          children: cart.map(function (item, index) {\n            return /*#__PURE__*/_jsx(\"div\", {\n              className: \"border-b py-10\",\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"flex items-center\",\n                children: [/*#__PURE__*/_jsx(Image, {\n                  className: \"w-32 m-0\",\n                  src: item.image,\n                  alt: item.name\n                }), /*#__PURE__*/_jsx(\"p\", {\n                  className: \"m-0 pl-10 text-gray-600\",\n                  children: item.name\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"flex flex-1 justify-end\",\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    className: \"m-0 pl-10 text-gray-900 font-semibold\",\n                    children: DENOMINATION + item.price\n                  })\n                })]\n              })\n            }, index);\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-1 flex-col md:flex-row\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"flex flex-1 pt-8 flex-col\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"mt-4 border-t pt-10\",\n              children: /*#__PURE__*/_jsxs(\"form\", {\n                onSubmit: handleSubmit,\n                children: [errorMessage ? /*#__PURE__*/_jsx(\"span\", {\n                  children: errorMessage\n                }) : \"\", /*#__PURE__*/_jsx(Input, {\n                  onChange: onChange,\n                  value: input.name,\n                  name: \"name\",\n                  placeholder: \"Cardholder name\"\n                }), /*#__PURE__*/_jsx(CardElement, {\n                  className: \"mt-2 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\n                }), /*#__PURE__*/_jsx(Input, {\n                  onChange: onChange,\n                  value: input.email,\n                  name: \"email\",\n                  placeholder: \"Email\"\n                }), /*#__PURE__*/_jsx(Input, {\n                  onChange: onChange,\n                  value: input.street,\n                  name: \"street\",\n                  placeholder: \"Street\"\n                }), /*#__PURE__*/_jsx(Input, {\n                  onChange: onChange,\n                  value: input.city,\n                  name: \"city\",\n                  placeholder: \"City\"\n                }), /*#__PURE__*/_jsx(Input, {\n                  onChange: onChange,\n                  value: input.state,\n                  name: \"state\",\n                  placeholder: \"State\"\n                }), /*#__PURE__*/_jsx(Input, {\n                  onChange: onChange,\n                  value: input.postal_code,\n                  name: \"postal_code\",\n                  placeholder: \"Postal Code\"\n                }), /*#__PURE__*/_jsx(\"button\", (_jsx2 = {\n                  type: \"submit\",\n                  disabled: !stripe,\n                  onClick: handleSubmit,\n                  className: \"hidden md:block bg-primary hover:bg-black text-white font-bold py-2 px-4 mt-4 rounded focus:outline-none focus:shadow-outline\"\n                }, _defineProperty(_jsx2, \"type\", \"button\"), _defineProperty(_jsx2, \"children\", \"Confirm order\"), _jsx2))]\n              })\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"md:pt-20\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"pl-4 flex flex-1 pt-2 md:pt-8 mt-2 sm:mt-0\",\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                className: \"text-sm pr-10 text-left\",\n                children: \"Subtotal\"\n              }), /*#__PURE__*/_jsx(\"p\", {\n                className: \"w-38 flex text-right justify-end\",\n                children: DENOMINATION + total\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"pl-4 flex flex-1 my-2\",\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                className: \"text-sm pr-10\",\n                children: \"Shipping\"\n              }), /*#__PURE__*/_jsx(\"p\", {\n                className: \"w-38 flex justify-end\",\n                children: \"FREE SHIPPING\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"md:ml-4 pl-2 flex flex-1 bg-gray-200 pr-4 pb-1 pt-2 mt-2\",\n              children: [/*#__PURE__*/_jsx(\"p\", {\n                className: \"text-sm pr-10\",\n                children: \"Total\"\n              }), /*#__PURE__*/_jsx(\"p\", {\n                className: \"font-semibold w-38 flex justify-end\",\n                children: DENOMINATION + (total + calculateShipping())\n              })]\n            }), /*#__PURE__*/_jsx(\"button\", (_jsx3 = {\n              type: \"submit\",\n              disabled: !stripe,\n              onClick: handleSubmit,\n              className: \"md:hidden bg-primary hover:bg-black text-white font-bold py-2 px-4 mt-4 rounded focus:outline-none focus:shadow-outline\"\n            }, _defineProperty(_jsx3, \"type\", \"button\"), _defineProperty(_jsx3, \"children\", \"Confirm order\"), _jsx3))]\n          })]\n        })]\n      })]\n    })]\n  });\n};\n\nexport default CheckoutWithContext;","map":null,"metadata":{},"sourceType":"module"}